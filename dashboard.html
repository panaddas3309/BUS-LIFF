<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    /* Google style loader */
    #loading {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .lds-ring {
      display: inline-block;
      position: relative;
      width: 80px;
      height: 80px;
    }
    .lds-ring div {
      box-sizing: border-box;
      display: block;
      position: absolute;
      width: 64px;
      height: 64px;
      margin: 8px;
      border: 8px solid #4285F4;
      border-radius: 50%;
      animation: lds-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
      border-color: #4285F4 transparent transparent transparent;
    }
    .lds-ring div:nth-child(1) { animation-delay: -0.45s; border-color:#34A853 transparent transparent transparent;}
    .lds-ring div:nth-child(2) { animation-delay: -0.3s; border-color:#FBBC05 transparent transparent transparent;}
    .lds-ring div:nth-child(3) { animation-delay: -0.15s; border-color:#EA4335 transparent transparent transparent;}
    @keyframes lds-ring {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-gray-100">

<!-- Loader -->
<div id="loading">
  <div class="lds-ring"><div></div><div></div><div></div><div></div></div>
</div>

<!-- Dashboard Content -->
<div id="dashboardContent" style="display:none;">

  <!-- ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå + ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à -->
  <div class="bg-white rounded-2xl shadow-md p-4 mb-6" id="profileCard">
    <div class="flex items-center mb-3">
      <img src="" alt="‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå" id="profileImage" class="w-16 h-16 rounded-full mr-4 border-2 border-blue-500"/>
      <div>
        <p class="text-gray-500">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞</p>
        <p class="font-bold text-lg text-gray-800" id="profileName"></p>
        <p class="text-gray-400 text-sm" id="employeeCode"></p>
      </div>
    </div>
    <p class="text-blue-600 font-medium text-sm" id="motivationMessage"></p>
  </div>

  <!-- Tabs -->
  <div class="flex justify-center mb-6 space-x-2">
    <button id="tab-remain" class="px-5 py-2 rounded-full bg-white text-blue-600 font-semibold shadow-md" onclick="showTab('remain')">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</button>
    <button id="tab-used" class="px-5 py-2 rounded-full bg-gray-200 text-gray-500 font-semibold" onclick="showTab('used')">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</button>
  </div>

  <!-- Content -->
  <div id="remain" class="grid gap-4"></div>
  <div id="used" class="grid gap-4 hidden"></div>

</div>

<script>
// ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à
const motivationTexts = [
  "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö!", "‡∏î‡∏µ‡πÉ‡∏à‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ!", "‡∏™‡∏π‡πâ ‡πÜ ‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏Ñ‡∏£‡∏±‡∏ö!",
  "‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ!", "‡∏¢‡∏¥‡πâ‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ!", "‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô!",
  "‡∏°‡∏≤‡∏™‡∏≥‡∏£‡∏ß‡∏à‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏•‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏±‡∏ô!", "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡πá‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö!", "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏•‡∏±‡∏á‡∏ö‡∏ß‡∏Å‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!",
  "‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô ‡∏Ñ‡∏∏‡∏ì‡∏Å‡πá‡πÄ‡∏≠‡∏≤‡∏≠‡∏¢‡∏π‡πà!", "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏à‡∏≠‡∏Å‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!", "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏°‡∏≠!",
  "‡∏°‡∏≤‡∏•‡∏∏‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö!", "‡∏û‡∏±‡∏Å‡∏ö‡πâ‡∏≤‡∏á‡∏Å‡πá‡πÑ‡∏î‡πâ‡∏ô‡∏∞ ‡πÅ‡∏ï‡πà‡∏´‡πâ‡∏≤‡∏°‡∏¢‡∏≠‡∏°‡πÅ‡∏û‡πâ!", "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡πâ‡∏≤‡∏ß‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏Ñ‡∏£‡∏±‡∏ö!",
  "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡πÄ‡∏à‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢ ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Å‡πà‡∏á‡∏û‡∏≠!", "‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏°‡πÄ‡∏¢‡∏≠‡∏∞ ‡πÜ ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!"
];

function getRandomMotivation() {
  return motivationTexts[Math.floor(Math.random() * motivationTexts.length)];
}

// Tabs toggle
function showTab(tab) {
  const remain = document.getElementById("remain");
  const used = document.getElementById("used");
  const tabRemain = document.getElementById("tab-remain");
  const tabUsed = document.getElementById("tab-used");

  if (tab === "remain") {
    remain.classList.remove("hidden");
    used.classList.add("hidden");
    tabRemain.classList.add("bg-white","text-blue-600","shadow-md");
    tabRemain.classList.remove("bg-gray-200","text-gray-500");
    tabUsed.classList.add("bg-gray-200","text-gray-500");
    tabUsed.classList.remove("bg-white","text-blue-600","shadow-md");
  } else {
    remain.classList.add("hidden");
    used.classList.remove("hidden");
    tabUsed.classList.add("bg-white","text-blue-600","shadow-md");
    tabUsed.classList.remove("bg-gray-200","text-gray-500");
    tabRemain.classList.add("bg-gray-200","text-gray-500");
    tabRemain.classList.remove("bg-white","text-blue-600","shadow-md");
  }
}

// Render Tabs
function renderRemainTab(data) {
  const remain = document.getElementById('remain');
  remain.innerHTML = '';
  const types = [
    {name:'‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô', emoji:'üå¥', value:data[2]}, // C
    {name:'‡∏•‡∏≤‡∏Å‡∏¥‡∏à', emoji:'üìÑ', value:data[3]},    // D
    {name:'‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢', emoji:'ü§í', value:data[4]},   // E
    {name:'‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô', emoji:'‚ùå', value:data[5]}   // F
  ];
  types.forEach(t => {
    const div = document.createElement('div');
    div.className = "flex justify-between items-center bg-white p-4 rounded-2xl shadow hover:scale-102 transition-transform";
    div.innerHTML = `<div class="flex items-center space-x-3"><span class="text-xl">${t.emoji}</span><span class="font-medium text-gray-700">${t.name}</span></div><span class="text-green-600 font-bold text-lg">${t.value} ‡∏ß‡∏±‡∏ô</span>`;
    remain.appendChild(div);
  });
}

function renderUsedTab(data) {
  const used = document.getElementById('used');
  used.innerHTML = '';
  const types = [
    {name:'‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô', emoji:'üå¥', value:data[2]}, // D
    {name:'‡∏•‡∏≤‡∏Å‡∏¥‡∏à', emoji:'üìÑ', value:data[3]},    // E
    {name:'‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢', emoji:'ü§í', value:data[4]},   // F
    {name:'‡∏Ç‡∏≤‡∏î‡∏á‡∏≤‡∏ô', emoji:'‚ùå', value:data[5]}   // G
  ];
  types.forEach(t => {
    const div = document.createElement('div');
    div.className = "flex justify-between items-center bg-white p-4 rounded-2xl shadow hover:scale-102 transition-transform";
    div.innerHTML = `<div class="flex items-center space-x-3"><span class="text-xl">${t.emoji}</span><span class="font-medium text-gray-700">${t.name}</span></div><span class="text-red-600 font-bold text-lg">${t.value} ‡∏ß‡∏±‡∏ô</span>`;
    used.appendChild(div);
  });
}

// Initialize dashboard
async function initializeDashboard() {
  const loading = document.getElementById('loadingScreen');
  const content = document.getElementById('dashboardContent');

  try {
    await liff.init({ liffId: "2007956727-rbZz9a0z" });
    if (!liff.isLoggedIn()) liff.login();
    const profile = await liff.getProfile();
    const lineUserId = profile.userId;

    // Fetch ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Apps Script
    const res = await fetch('https://script.google.com/macros/s/AKfycbweaBqP-v0PkITA_TAhRlho-UGIqP_3A4pkk8MBSTsy-Lx9u-Rh1ChCZLn7vSsXXaim/exec?lineUserId='+lineUserId);
    const data = await res.json();

    if (!data.found) {
      window.location.href = 'LineID_Registration.html';
      return;
    }

    const balanceData = data.balance; // A-F
    const recordsData = data.records; // A,B,D,E,F,G

    // ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
    document.getElementById('profileImage').src = profile.pictureUrl;
    document.getElementById('profileName').textContent = balanceData[1]; // ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å Column B
    document.getElementById('employeeCode').textContent = '‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô: ' + balanceData[0];
    document.getElementById('motivationMessage').textContent = getRandomMotivation();

    // Render Tabs
    renderRemainTab(balanceData);
    renderUsedTab(recordsData);

    // ‡πÅ‡∏™‡∏î‡∏á dashboard ‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏ô loading
    loading.style.display = 'none';
    content.style.display = 'block';

  } catch(e) {
    console.error(e);
    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
    loading.style.display = 'none';
  }
}

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
initializeDashboard();
</script>

</body>
</html>
